$T_DNSBL=jQuery.noConflict();var flagIndex;function torneDnsblApi(b,d,a){var c="POST";if(typeof arguments[3]!="undefined"){c=arguments[3]}$T_DNSBL.ajax({url:tornevall_dnsbl_vars.ajax_url,method:c,data:{action:"tornednsbl",request:b,postdata:a,n:tornevall_dnsbl_vars.dnsbln}}).done(function(e){if(typeof d=="function"&&typeof e.response!=="undefined"){d(e)}})}function runApiTest(a){$T_DNSBL("#apiTestResponse").html('<img src="'+tornevall_dnsbl_vars.spinner+'">');$T_DNSBL("#apiTestResponse").show();if(a=="test"){torneDnsblApi("test",function(b){if(typeof b.errorstring&&b.errorstring!=""){$T_DNSBL("#apiTestResponse").html(b.errorstring)}else{if(typeof b.response!=""){if(typeof b.response["returnRandomResponse"]!="undefined"){$T_DNSBL("#apiTestResponse").html('<span style="font-weight: bold;color:#ff9900;">'+tornevall_dnsbl_vars.tr_api_reply_success+": "+b.response["returnRandomResponse"]+"</span>")}else{var c=b.response["keyResponse"]["appClientData"];$T_DNSBL("#apiTestResponse").html('<span style="font-weight: bold;color:#009900;">'+tornevall_dnsbl_vars.tr_api_reply_authorized+": "+(c.AUTHORIZED=="1"?"OK<br>"+tornevall_dnsbl_vars.saveConfigNotice:tornevall_dnsbl_vars.tr_api_reply_fail)+"</span>")}}}},{verb:$T_DNSBL("#tornevall_dnsbl_api_key").val()!=""?"key":"returnRandom",application:$T_DNSBL("#tornevall_dnsbl_api_id").val(),authKey:$T_DNSBL("#tornevall_dnsbl_api_key").val()})}else{if(a=="flags"){torneDnsblApi("dnsbl",function(b){if(typeof b.response!="undefined"){$T_DNSBL("#apiTestResponse").html('<span style="font-weight: bold;color:#009900;">'+tornevall_dnsbl_vars.tr_flags_updated+"</span>")}else{$T_DNSBL("#apiTestResponse").html('<span style="font-weight: bold;color:#990000;">'+tornevall_dnsbl_vars.tr_request_failure+"</span>");$T_DNSBL("#apiTestResponse").html('<span style="font-weight: bold;color:#990000;">'+tornevall_dnsbl_vars.tr_request_failure+"</span>")}},{verb:"getFlags"})}}}function tFindDnsblAddr(){$T_DNSBL("#delistingTestStatus").html('<img src="'+tornevall_dnsbl_vars.spinner+'">');$T_DNSBL("#delistingTestStatus").show();if($T_DNSBL("#findIpAddr").val()==""){$T_DNSBL("#delistingTestStatus").html(tornevall_dnsbl_vars.tr_no_empty_value);return}var a=[""];if(tornevall_dnsbl_vars.tornevall_dnsbl_getlisted_resolver=="1"){a=["resolve"]}torneDnsblApi("dnsbl",function(i){if(typeof i.errorcode!="undefined"&&i.errorcode>=400){$T_DNSBL("#delistingTestStatus").html('<div style="margin-top: 3px;padding:5px;color:#990000;border:1px solid #FF0000;background: #F0B0B0">'+i.errorstring+"</div>")}else{if(typeof i.response!="undefined"){var h="";var b=i.response["requestResponse"];var g=null;var d=null;var f;for(requestIndex=0;requestIndex<b.length;requestIndex++){d=b[requestIndex]["ip"];g=b[requestIndex]["typebit"];if(null!=g){var k=b[requestIndex]["constants"].join("<br>");var c=b[requestIndex]["constants"].join("\n");var l=b[requestIndex]["deleted"];var j="";var e;if(b[requestIndex]["hasResolveFlag"]=="1"){e=b[requestIndex]["resolve"];if(e!=""&&d!=e){if(e!=b[requestIndex]["lastResolve"]){e+=" / "+b[requestIndex]["lastResolve"]}d+=" ("+e+")"}}else{e=null}if(l=="0000-00-00 00:00:00"||null==l){j=tornevall_dnsbl_vars.tr_blacklisted;isActiveColor="#990000";f="#990000"}else{j=tornevall_dnsbl_vars.tr_removed+" "+l;isActiveColor="#009900";f="#009900"}h+='<div style="font-weight:bold;color:'+isActiveColor+'" title="'+c+'">';h+="     <span onclick=\"$T_DNSBL('#dnsbl_ip_flags_"+requestIndex+"').show()\">";h+='         <img style="vertical-align: middle;" src="'+tornevall_dnsbl_vars.q+'">';h+="     </span>";if(b.length==1){h+="     <span onclick=\"setDelistAddr('"+d+"', "+requestIndex+')">';h+='         <img style="vertical-align: middle;" src="'+tornevall_dnsbl_vars.d+'">';h+="     </span>"}h+=d+": "+j;h+='     <div id="dnsbl_ip_flags_'+requestIndex+'" style="display: none;color:#000000 !important;">'+k+"</div>";h+="</div>"}else{isActiveColor="#009999";f="#009999";h+='<div style="cursor: pointer;font-weight:bold;color:'+isActiveColor+'" title="'+k+'">'+d+": "+tornevall_dnsbl_vars.tr_not_blacklisted+"</div>"}}$T_DNSBL("#delistingTestStatus").html('<div style="margin-top: 3px;padding:5px; color:#990000;border:1px solid '+f+';background: #FFFFE0">'+h+"</div>")}}},{verb:"request",ip:$T_DNSBL("#findIpAddr").val(),n:$T_DNSBL("#dNonce").val(),flags:a})}function setDelistAddr(b,a){flagIndex=a;$T_DNSBL("#delistingWorker").html('<img src="'+tornevall_dnsbl_vars.spinner+'">');$T_DNSBL("#delistingWorker").show();torneDnsblApi("captcha",function(d){$T_DNSBL("#delistingWorker").html("");$T_DNSBL("#delistingWorker").hide();if(typeof d.response!=="undefined"&&d.response["getCaptchaResponse"]!=="undefined"){var g=d.response["getCaptchaResponse"];var c=g.imageHash;var f=g.imageUrl;var e='<form id="submit_captcha" onsubmit="return false;"><input type="hidden" value="'+c+'" id="meHash"><img src="'+f+'"><br><b>'+tornevall_dnsbl_vars.tr_captcha_image+'</b><input type="text" vaue="" id="meImage"><br><input id="setDelistAddrBtn" type="button" value="Submit" onclick="setDelistCaptcha()"></form>';$T_DNSBL("#dnsbl_ip_flags_"+a).html(e);$T_DNSBL("#dnsbl_ip_flags_"+a).show();$T_DNSBL("#setDelistAddrBtn").click()}},{verb:"getCaptcha",n:tornevall_dnsbl_vars.dnsbln})}function setDelistCaptcha(){var a=$T_DNSBL("#meImage").val();var b=$T_DNSBL("#meHash").val();var c=$T_DNSBL("#findIpAddr").val();if((a!=""&&b!="")||tornevall_dnsbl_vars.tornevall_dnsbl_is_admin_notification){$T_DNSBL("#delistingWorker").html('<img src="'+tornevall_dnsbl_vars.spinner+'">');$T_DNSBL("#delistingWorker").show();torneDnsblApi("captcha",function(d){$T_DNSBL("#delistingWorker").html("");$T_DNSBL("#delistingWorker").hide();if(typeof d.response!="undefined"&&typeof d.response["testCaptchaResponse"]!="undefined"){if(d.response["testCaptchaResponse"]=="1"){torneDnsblApi("dnsbl",function(f){if(f.errorstring!=""){$T_DNSBL("#dnsbl_ip_flags_"+flagIndex).html(f.errorstring)}else{if(typeof f.response!="undefined"&&typeof f.response["dnsblResponse"]!="undefined"){var e=f.response["dnsblResponse"];if(typeof e.status["0"]!="undefined"){var g=e.status["0"];var h="";if(g.state=="delete"){h=g.addr+": "+tornevall_dnsbl_vars.tr_delist_success;if(typeof g.penalties["removalCount"]!="undefined"){h+=" "+tornevall_dnsbl_vars.tr_delist_penalties+"<br>";h+=tornevall_dnsbl_vars.tr_delist_extended+g.penalties["removaltime"]}$T_DNSBL("#dnsbl_ip_flags_"+flagIndex).html(h)}}}}},{verb:"",ip:c,n:tornevall_dnsbl_vars.dnsbln,method:"delete"})}}else{if(d.errorstring!=""){$T_DNSBL("#dnsbl_ip_flags_"+flagIndex).html(d.errorstring)}}},{verb:"testCaptcha",hash:b,response:a})}}function findIpAddrPress(b){var a=(typeof b.which==="number")?b.which:b.keyCode;if(a==13){tFindDnsblAddr()}};